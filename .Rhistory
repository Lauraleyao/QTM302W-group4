knitr::opts_chunk$set(echo = TRUE, fig.path = "figure/")
# 0. Setup: Install and Load Libraries
# We load the tidyverse for data manipulation and visualization,
# lubridate for date handling, and corrplot for statistical summaries.
library(tidyverse)
library(lubridate)
library(patchwork)
library(corrplot)
library(ggplot2)
library(dplyr)
library(tidyr)
library(zoo)
library(scales) # For better axis formatting
knitr::opts_chunk$set(echo = TRUE, fig.path = "figure/")
# Load the dataset
data <- read.csv("data/2025-09-QD.csv")
# Remove the metadata row containing transformation codes (Row 2 in original file)
data <- data[-1, ]
# Rename and format the date column
names(data)[1] <- "date"
data$date <- as.Date(data$date, "%m/%d/%Y")
# Convert relevant data columns to numeric, coercing any remaining non-data text to NA
data <- data %>%
mutate(across(-date, ~as.numeric(as.character(.))))
# Define the sample period: Q1 2000 to Q3 2025
startSample <- as.Date("2000-01-01")
endSample   <- as.Date("2025-08-01")
# Create the primary analytical dataframe
df <- data %>%
filter(date >= startSample & date <= endSample)
# Define variables of interest
vars_to_summarize <- c("GDPC1", "PCECC96", "GPDIC1", "GCEC1", "HOUST",
"MORTGAGE30US", "FEDFUNDS", "UMCSENTx", "USSTHPI", "DPIC96")
# Custom function to calculate summary statistics
get_stats <- function(x) {
c(
N = length(x) - sum(is.na(x)), # Count of non-missing values
Mean = mean(x, na.rm = TRUE),
StDev = sd(x, na.rm = TRUE),
Min = min(x, na.rm = TRUE),
Median = median(x, na.rm = TRUE),
Max = max(x, na.rm = TRUE)
)
}
# Apply function to selected variables
summary_matrix <- sapply(df[vars_to_summarize], get_stats)
summary_table <- t(summary_matrix)
# Assign readable labels for the final report
readable_names <- c("GDP", "Consumption", "Investment", "Gov. Spend",
"Housing Starts", "Mortgage Rate", "Fed Funds Rate",
"Sentiment", "House Price Idx", "Disp. Income")
rownames(summary_table) <- readable_names
# Output the table
knitr::kable(summary_table,
digits = 2,
caption = "Descriptive Statistics for Key Variables (2000-2025)")
# Calculate components as a % of Real GDP
df <- df %>%
mutate(
C_proportion = PCECC96 / GDPC1,
I_proportion = GPDIC1 / GDPC1,
G_proportion = GCEC1 / GDPC1,
X_proportion = EXPGSC1 / GDPC1,
M_proportion = IMPGSC1 / GDPC1,
NX_proportion = (EXPGSC1 - IMPGSC1) / GDPC1
)
# Plot 1: Line chart for absolute trend analysis
p_value_line_all <- ggplot(df, aes(x = date)) +
geom_line(aes(y = PCECC96, color = "Consumption"), size=1) +
geom_line(aes(y = GPDIC1, color = "Investment"), size=1) +
geom_line(aes(y = GCEC1, color = "Gov. Spending"), size=1) +
# Add vertical lines to mark major crises for context
geom_vline(xintercept = as.Date("2008-09-01"), linetype="dashed", color="gray50") +
geom_vline(xintercept = as.Date("2018-07-01"), linetype="dashed", color="gray50") +
geom_vline(xintercept = as.Date("2020-03-01"), linetype="dashed", color="gray50") +
labs(title = "Total Value of GDP Components (2000-2025)",
subtitle = "Dashed lines indicate 2008 Crisis, 2018 Trade War, and 2020 Pandemic Start",
y = "Billions of Chained Dollars", x = "Date") +
scale_y_continuous(labels = scales::dollar) +
scale_color_manual(name = "Component", values = c("Consumption" = "#1f77b4",
"Investment" = "#d62728",
"Gov. Spending" = "#2ca02c")) +
theme_minimal() +
theme(legend.position = "bottom")
p_value_line_all
# Plot 2: Stacked area chart for structural composition
p_proportions_area_full <- df %>%
select(date, C_proportion, I_proportion, G_proportion, NX_proportion) %>%
pivot_longer(cols = -date, names_to = "component", values_to = "proportion") %>%
ggplot(aes(x = date, y = proportion, fill = component)) +
geom_area(alpha=0.8) +
labs(title = "Structural Composition of U.S. GDP",
y = "Proportion of GDP", x = "") +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(name = "Component",
values = c("C_proportion"="#7fc97f", "I_proportion"="#beaed4",
"G_proportion"="#fdc086", "NX_proportion"="#ffff99"),
labels = c("Consumption", "Gov. Spending", "Investment", "Net Exports")) +
theme_minimal()
p_proportions_area_full
knitr::opts_chunk$set(echo = TRUE, fig.path = "figures/")
# 0. Setup: Install and Load Libraries
# We load the tidyverse for data manipulation and visualization,
# lubridate for date handling, and corrplot for statistical summaries.
library(tidyverse)
library(lubridate)
library(patchwork)
library(corrplot)
library(ggplot2)
library(dplyr)
library(tidyr)
library(zoo)
library(scales) # For better axis formatting
knitr::opts_chunk$set(echo = TRUE, fig.path = "figures/")
# Load the dataset
data <- read.csv("data/2025-09-QD.csv")
# Remove the metadata row containing transformation codes (Row 2 in original file)
data <- data[-1, ]
# Rename and format the date column
names(data)[1] <- "date"
data$date <- as.Date(data$date, "%m/%d/%Y")
# Convert relevant data columns to numeric, coercing any remaining non-data text to NA
data <- data %>%
mutate(across(-date, ~as.numeric(as.character(.))))
# Define the sample period: Q1 2000 to Q3 2025
startSample <- as.Date("2000-01-01")
endSample   <- as.Date("2025-08-01")
# Create the primary analytical dataframe
df <- data %>%
filter(date >= startSample & date <= endSample)
# Define variables of interest
vars_to_summarize <- c("GDPC1", "PCECC96", "GPDIC1", "GCEC1", "HOUST",
"MORTGAGE30US", "FEDFUNDS", "UMCSENTx", "USSTHPI", "DPIC96")
# Custom function to calculate summary statistics
get_stats <- function(x) {
c(
N = length(x) - sum(is.na(x)), # Count of non-missing values
Mean = mean(x, na.rm = TRUE),
StDev = sd(x, na.rm = TRUE),
Min = min(x, na.rm = TRUE),
Median = median(x, na.rm = TRUE),
Max = max(x, na.rm = TRUE)
)
}
# Apply function to selected variables
summary_matrix <- sapply(df[vars_to_summarize], get_stats)
summary_table <- t(summary_matrix)
# Assign readable labels for the final report
readable_names <- c("GDP", "Consumption", "Investment", "Gov. Spend",
"Housing Starts", "Mortgage Rate", "Fed Funds Rate",
"Sentiment", "House Price Idx", "Disp. Income")
rownames(summary_table) <- readable_names
# Output the table
knitr::kable(summary_table,
digits = 2,
caption = "Descriptive Statistics for Key Variables (2000-2025)")
# Calculate components as a % of Real GDP
df <- df %>%
mutate(
C_proportion = PCECC96 / GDPC1,
I_proportion = GPDIC1 / GDPC1,
G_proportion = GCEC1 / GDPC1,
X_proportion = EXPGSC1 / GDPC1,
M_proportion = IMPGSC1 / GDPC1,
NX_proportion = (EXPGSC1 - IMPGSC1) / GDPC1
)
# Plot 1: Line chart for absolute trend analysis
p_value_line_all <- ggplot(df, aes(x = date)) +
geom_line(aes(y = PCECC96, color = "Consumption"), size=1) +
geom_line(aes(y = GPDIC1, color = "Investment"), size=1) +
geom_line(aes(y = GCEC1, color = "Gov. Spending"), size=1) +
# Add vertical lines to mark major crises for context
geom_vline(xintercept = as.Date("2008-09-01"), linetype="dashed", color="gray50") +
geom_vline(xintercept = as.Date("2018-07-01"), linetype="dashed", color="gray50") +
geom_vline(xintercept = as.Date("2020-03-01"), linetype="dashed", color="gray50") +
labs(title = "Total Value of GDP Components (2000-2025)",
subtitle = "Dashed lines indicate 2008 Crisis, 2018 Trade War, and 2020 Pandemic Start",
y = "Billions of Chained Dollars", x = "Date") +
scale_y_continuous(labels = scales::dollar) +
scale_color_manual(name = "Component", values = c("Consumption" = "#1f77b4",
"Investment" = "#d62728",
"Gov. Spending" = "#2ca02c")) +
theme_minimal() +
theme(legend.position = "bottom")
p_value_line_all
# Plot 2: Stacked area chart for structural composition
p_proportions_area_full <- df %>%
select(date, C_proportion, I_proportion, G_proportion, NX_proportion) %>%
pivot_longer(cols = -date, names_to = "component", values_to = "proportion") %>%
ggplot(aes(x = date, y = proportion, fill = component)) +
geom_area(alpha=0.8) +
labs(title = "Structural Composition of U.S. GDP",
y = "Proportion of GDP", x = "") +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(name = "Component",
values = c("C_proportion"="#7fc97f", "I_proportion"="#beaed4",
"G_proportion"="#fdc086", "NX_proportion"="#ffff99"),
labels = c("Consumption", "Gov. Spending", "Investment", "Net Exports")) +
theme_minimal()
p_proportions_area_full
# Select variables of interest for correlation analysis
selected_vars <- df %>%
select(GDPC1, PCECC96, GPDIC1, GCEC1, HOUST, MORTGAGE30US, FEDFUNDS, UMCSENTx, USSTHPI, DPIC96)
readable_names <- c("GDP", "Consumption", "Investment", "Gov. Spend", "Housing Starts",
"Mortgage Rate", "Fed Funds Rate", "Sentiment", "House Price Idx", "Disp. Income")
cor_matrix <- cor(selected_vars, use = "pairwise.complete.obs")
colnames(cor_matrix) <- readable_names
rownames(cor_matrix) <- readable_names
# Visualizing the matrix
corrplot(cor_matrix, method = "color",
type = "upper",
order = "hclust",
addCoef.col = "black", tl.col = "black",
tl.srt = 45, diag = FALSE,
number.cex = 0.7,
title = "Correlation Matrix of Key Economic Variables", mar=c(0,0,1,0))
knitr::opts_chunk$set(echo = TRUE, fig.path = "figures/")
# Create the folder if it doesn't exist
if (!dir.exists("figures")) {
dir.create("figures")
}
# Set global options to save figures to the 'figures/' folder
knitr::opts_chunk$set(echo = TRUE, fig.path = "figures/")
# Create the folder if it doesn't exist
if (!dir.exists("figures")) {
dir.create("figures")
}
# Set global options to save figures to the 'figures/' folder
knitr::opts_chunk$set(echo = TRUE, fig.path = "figures/")
# Load the dataset
data <- read.csv("data/2025-09-QD.csv")
# Remove the metadata row containing transformation codes (Row 2 in original file)
data <- data[-1, ]
# Rename and format the date column
names(data)[1] <- "date"
data$date <- as.Date(data$date, "%m/%d/%Y")
# Convert relevant data columns to numeric, coercing any remaining non-data text to NA
data <- data %>%
mutate(across(-date, ~as.numeric(as.character(.))))
# Define the sample period: Q1 2000 to Q3 2025
startSample <- as.Date("2000-01-01")
endSample   <- as.Date("2025-08-01")
# Create the primary analytical dataframe
df <- data %>%
filter(date >= startSample & date <= endSample)
# Define variables of interest
vars_to_summarize <- c("GDPC1", "PCECC96", "GPDIC1", "GCEC1", "HOUST",
"MORTGAGE30US", "FEDFUNDS", "UMCSENTx", "USSTHPI", "DPIC96")
# Custom function to calculate summary statistics
get_stats <- function(x) {
c(
N = length(x) - sum(is.na(x)), # Count of non-missing values
Mean = mean(x, na.rm = TRUE),
StDev = sd(x, na.rm = TRUE),
Min = min(x, na.rm = TRUE),
Median = median(x, na.rm = TRUE),
Max = max(x, na.rm = TRUE)
)
}
# Apply function to selected variables
summary_matrix <- sapply(df[vars_to_summarize], get_stats)
summary_table <- t(summary_matrix)
# Assign readable labels for the final report
readable_names <- c("GDP", "Consumption", "Investment", "Gov. Spend",
"Housing Starts", "Mortgage Rate", "Fed Funds Rate",
"Sentiment", "House Price Idx", "Disp. Income")
rownames(summary_table) <- readable_names
# Output the table
knitr::kable(summary_table,
digits = 2,
caption = "Descriptive Statistics for Key Variables (2000-2025)")
# Calculate components as a % of Real GDP
df <- df %>%
mutate(
C_proportion = PCECC96 / GDPC1,
I_proportion = GPDIC1 / GDPC1,
G_proportion = GCEC1 / GDPC1,
X_proportion = EXPGSC1 / GDPC1,
M_proportion = IMPGSC1 / GDPC1,
NX_proportion = (EXPGSC1 - IMPGSC1) / GDPC1
)
# Plot 1: Line chart for absolute trend analysis
p_value_line_all <- ggplot(df, aes(x = date)) +
geom_line(aes(y = PCECC96, color = "Consumption"), size=1) +
geom_line(aes(y = GPDIC1, color = "Investment"), size=1) +
geom_line(aes(y = GCEC1, color = "Gov. Spending"), size=1) +
# Add vertical lines to mark major crises for context
geom_vline(xintercept = as.Date("2008-09-01"), linetype="dashed", color="gray50") +
geom_vline(xintercept = as.Date("2018-07-01"), linetype="dashed", color="gray50") +
geom_vline(xintercept = as.Date("2020-03-01"), linetype="dashed", color="gray50") +
labs(title = "Total Value of GDP Components (2000-2025)",
subtitle = "Dashed lines indicate 2008 Crisis, 2018 Trade War, and 2020 Pandemic Start",
y = "Billions of Chained Dollars", x = "Date") +
scale_y_continuous(labels = scales::dollar) +
scale_color_manual(name = "Component", values = c("Consumption" = "#1f77b4",
"Investment" = "#d62728",
"Gov. Spending" = "#2ca02c")) +
theme_minimal() +
theme(legend.position = "bottom")
p_value_line_all
# Plot 2: Stacked area chart for structural composition
p_proportions_area_full <- df %>%
select(date, C_proportion, I_proportion, G_proportion, NX_proportion) %>%
pivot_longer(cols = -date, names_to = "component", values_to = "proportion") %>%
ggplot(aes(x = date, y = proportion, fill = component)) +
geom_area(alpha=0.8) +
labs(title = "Structural Composition of U.S. GDP",
y = "Proportion of GDP", x = "") +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(name = "Component",
values = c("C_proportion"="#7fc97f", "I_proportion"="#beaed4",
"G_proportion"="#fdc086", "NX_proportion"="#ffff99"),
labels = c("Consumption", "Gov. Spending", "Investment", "Net Exports")) +
theme_minimal()
p_proportions_area_full
# Select variables of interest for correlation analysis
selected_vars <- df %>%
select(GDPC1, PCECC96, GPDIC1, GCEC1, HOUST, MORTGAGE30US, FEDFUNDS, UMCSENTx, USSTHPI, DPIC96)
readable_names <- c("GDP", "Consumption", "Investment", "Gov. Spend", "Housing Starts",
"Mortgage Rate", "Fed Funds Rate", "Sentiment", "House Price Idx", "Disp. Income")
cor_matrix <- cor(selected_vars, use = "pairwise.complete.obs")
colnames(cor_matrix) <- readable_names
rownames(cor_matrix) <- readable_names
# Visualizing the matrix
corrplot(cor_matrix, method = "color",
type = "upper",
order = "hclust",
addCoef.col = "black", tl.col = "black",
tl.srt = 45, diag = FALSE,
number.cex = 0.7,
title = "Correlation Matrix of Key Economic Variables", mar=c(0,0,1,0))
ggplot(data = df, aes(x = date))+
geom_line(aes( y = EXPGSC1, color = "Export"), size=1)+
geom_line(aes(y = IMPGSC1, color = "Import"), size=1)+
geom_line(aes(y = GDPC1, color = "GDP"), size=1.2, alpha=0.5)+
scale_color_manual(values = c("Export" = "darkblue",
"Import" = "orange",
"GDP" = "gray70"
)) +
# Highlight Tariff Policy Periods
annotate("rect", fill = "red", alpha = 0.1,
xmin = as.Date(c("2019-01-01")), xmax = as.Date(c("2019-06-30")),
ymin = -Inf, ymax = Inf) +
annotate("text", x = as.Date("2019-04-01"), y = 25000, label="Trade War", angle=90, vjust=1.5, size=3) +
annotate("rect", fill = "red", alpha = 0.1,
xmin = as.Date(c("2025-04-02")), xmax = as.Date(c("2025-09-01")),
ymin = -Inf, ymax = Inf) +
annotate("text", x = as.Date("2025-06-01"), y = 25000, label="Policy Adj.", angle=90, vjust=1.5, size=3) +
labs(color = "Metric",
title = "The Widening Gap: Imports vs. Exports",
subtitle = "Shaded regions indicate periods of active tariff policy changes",
x = "Year",
y = "Billions of Dollars") +
theme_minimal() +
theme(legend.position = "top")
# Plot A: Interest Rates vs Investment
p_scatter_investment <- ggplot(df, aes(x = FEDFUNDS, y = GPDIC1)) +
geom_point(alpha = 0.6, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black") +
labs(title = "Policy Inelasticity",
subtitle = "Fed Funds Rate vs. Real Investment",
x = "Federal Funds Rate (%)", y = "Real Investment (Billions)") +
theme_minimal()
# Plot B: Sentiment vs Consumption
p_scatter_sentiment <- ggplot(df, aes(x = UMCSENTx, y = PCECC96)) +
geom_point(alpha = 0.6, color = "darkblue") +
geom_smooth(method = "lm", se = FALSE, color = "black") +
labs(title = "The Sentiment Paradox",
subtitle = "Consumer Sentiment vs. Real Consumption",
x = "Consumer Sentiment Index", y = "Real Consumption (Billions)") +
theme_minimal()
# Plot C: Income vs Consumption
p_scatter_income <- ggplot(df, aes(x = DPIC96, y = PCECC96)) +
geom_point(alpha = 0.6, color = "purple") +
geom_smooth(method = "lm", se = FALSE, color = "black") +
labs(title = "The Income Driver",
subtitle = "Real Disposable Income vs. Real Consumption",
x = "Real Disposable Income", y = "Real Consumption") +
theme_minimal()
# Combine plots with a "2 over 1" layout to prevent overcrowding
combined_plot <- (p_scatter_investment + p_scatter_sentiment) / p_scatter_income
combined_plot + plot_annotation(
title = "Drivers of Economic Activity (2000 to 2025)",
caption = "Source: FRED-QD | Top row: Weak Correlations. Bottom row: Strong Positive Correlation.",
theme = theme(plot.title = element_text(size = 16, face = "bold"))
)
ggplot(data = df, aes(x = date))+
geom_line(aes(y = HOUST, color = "Nation Total"), linetype="dotted", alpha=0.5) +
geom_line(aes(y = HOUSTMW, color = "Midwest")) +
geom_line(aes(y = HOUSTNE, color = "Northeast")) +
geom_line(aes(y = HOUSTS, color = "South"), size=1.1) + # Emphasize South
geom_line(aes(y = HOUSTW, color = "West"))+
scale_color_manual(values = c("Nation Total" = "gray",
"Midwest" = "orange",
"Northeast" = "red",
"South" = "darkcyan", # Highlight color
"West" = "pink")) +
labs(color = "Region",
title = "New Housing Starts: The Southern Expansion",
subtitle = "The South (Teal) drives the majority of housing volume",
x = "Year",
y = "Units (Thousands)") +
theme_minimal()
# Calculate 6 month rolling average for Housing Permits to smooth volatility
df <- df %>%
mutate(MA_6month = zoo::rollmean(PERMIT, k = 6, fill = NA, align = "right"))
ggplot(df, aes(x = date)) +
geom_line(aes(y = HOUST, color = "Raw Data (Monthly)"), alpha=0.4) +
geom_line(aes(y = MA_6month, color = "6 Month Trend"), size = 1.2) +
labs(title = "Smoothing the Cycle",
subtitle = "National Housing Starts with 6 Month Moving Average",
x = "Date", y = "Units (Thousands)") +
scale_color_manual(values = c("Raw Data (Monthly)" = "gray50", "6 Month Trend" = "blue")) +
theme_minimal() +
theme(legend.position = "bottom")
# Plotting the relationship between Fiscal Spending and Housing
p_scatter_houst_gov <- ggplot(df, aes(x = GCEC1, y = HOUST)) +
geom_point(alpha = 0.7, color = "darkcyan") +
geom_smooth(method = "lm", se = FALSE, color = "black", linetype = "dashed") +
labs(title = "Fiscal Counter Cyclicality",
x = "Real Gov. Spending", y = "Housing Starts") +
theme_minimal()
p_scatter_houst_gov
renv::restore()
renv::init()
getwd()
setwd("~/Documents/GitHub/QTM302W-group4")
renv::init()
renv::snapshot()
renv::restore()
